server:
  port: 8080
  servlet:
    context-path: /

spring:
  application:
    name: police-kb

  # DashScope API配置
  ai:
    dashscope:
      api-key: sk-e8d86d11e21540d9b72bc83f78bf1154  # 请替换为有效的API密钥
      enabled: true
    agent:
      api-key: sk-e8d86d11e21540d9b72bc83f78bf1154
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://192.168.6.201:2881/police_kb?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: hj761209
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      idle-timeout: 30000
      pool-name: PoliceKBHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000

  data:
    redis:
      host: 192.168.6.201
      port: 6379
      password:
      database: 0
      timeout: 10000
      lettuce:
        pool:
          max-active: 8
          max-wait: -1ms
          max-idle: 8
          min-idle: 0

  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB

#  jackson:
#    date-format: yyyy-MM-dd HH:mm:ss
#    time-zone: Asia/Shanghai
#    serialization:
#      write-dates-as-timestamps: false

mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  type-aliases-package: com.police.kb.entity
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

sa-token:
  token-name: Authorization
  token-prefix: Bearer
  timeout: 86400
  is-concurrent: true
  is-share: false
  is-log: true
  jwt-secret-key: police-kb-jwt-secret-key-2025-must-be-at-least-256-bits-long

knife4j:
  enable: true
  setting:
    language: zh_cn
    swagger-model-name: 实体类

logging:
  level:
    com.police.kb: debug
    com.baomidou.mybatisplus: debug
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

# OceanBase SeekDB 向量库配置
# 官方文档: https://www.oceanbase.ai/docs/experience-hybrid-search
seekdb:
  host: 192.168.6.201
  port: 2881
  username: root
  password: hj761209
  database: police_kb
  collection: document_vectors
  dimension: 1024
  metric: COSINE
  ef-construction: 200
  ef-search: 200
  m: 24
  ai:
    embed-model: ob_embed
    embed-endpoint: ob_embed_endpoint
    provider: openai
    api-url: https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings
    api-key: ${SEEKDB_API_KEY:sk-e8d86d11e21540d9b72bc83f78bf1154}
    model-name: text-embedding-v4
    rerank-model:

# MinIO 配置
minio:
  endpoint: http://192.168.6.201:9000
  access-key: admin
  secret-key: admin123
  bucket-name: glza

  # 自定义配置
  summary:
    max-length: 200
    async-enabled: true
    cache-enabled: true
    cache-prefix: "police:kb:summary:"
    progress-ws-path: "/ws/summary/progress/"

  app:
  jwt:
    secret: police-kb-secret-key-2024-must-be-at-least-256-bits-long
    expiration: 86400000
  upload:
    path: ./uploads
    max-size: 104857600
    allowed-types: pdf,doc,docx,xls,xlsx,ppt,pptx,txt,md,jpg,jpeg,png,gif,bmp

# RAG检索增强生成配置
rag:
  # 检索配置
  retrieval:
    topk: 5
    similarity-threshold: 0.7
    enable-reranker: false

  # 分块策略配置
  chunking:
    strategy: token_count  # fixed, semantic, token_count
    chunk-size: 512
    chunk-overlap: 100
    min-chunk-size: 50
    max-chunk-size: 2000

  # 上下文工程配置
  context-engineering:
    enabled: true
    max-iterations: 3
    tool-retry:
      enabled: true
      max-attempts: 3
    context-compaction:
      enabled: true
      max-tokens: 4000
    human-in-the-loop:
      enabled: false
      threshold: 0.95

  # 流式对话配置
  streaming:
    heartbeat-interval: 30000
    connect-timeout: 30000
    read-timeout: 120000
    retry:
      enabled: true
      max-attempts: 3
      delay: 1000

  # 批处理配置
  kb:
    batch:
      default-batch-size: 10
      max-batch-size: 50
      min-batch-size: 1
      max-retries: 3
      batch-timeout-ms: 60000
      retry-delay-ms: 1000
      db-batch-size: 100
      db-max-retries: 3
      max-document-size: 10000
      chunk-overlap-size: 100
      enable-parallel-processing: false
      parallel-thread-count: 4

# 多模型配置
# 用于普通对话模式，支持多模型并行调用
chat:
  models:
    # DeepSeek Chat
    - id: deepseek-chat
      name: DeepSeek Chat
      provider: DeepSeek
      description: 深度求索对话模型，高性价比
      enabled: true
      api-key: sk-2cfce40081614b459baf0700daafd907
      base-url: https://api.deepseek.com
      model: deepseek-chat
      temperature: 0.7

    # DeepSeek Reasoner
    - id: deepseek-reasoner
      name: Deepseek Reasoner
      provider: DeepSeek
      description: 深度求索思考对话模型，高性价比
      enabled: true
      api-key: sk-2cfce40081614b459baf0700daafd907
      base-url: https://api.deepseek.com
      model: deepseek-reasoner
      temperature: 0.7

    # GLM-4.7
    - id: glm-4.7
      name: GLM-4.7
      provider: DeepSeek
      description: 深度求索思考对话模型，高性价比
      enabled: true
      api-key: sk-2cfce40081614b459baf0700daafd907
      base-url: https://api.deepseek.com
      model: deepseek-reasoner
      temperature: 0.7

    # Claude 3 Opus
    - id: claude-3-opus
      name: Claude 3 Opus
      provider: Anthropic
      description: Anthropic最强大的模型
      enabled: false
      api-key: YOUR_API_KEY
      base-url: https://api.anthropic.com/v1
      model: claude-3-opus
      temperature: 0.7

    # Claude 3 Sonnet
    - id: claude-3-sonnet
      name: Claude 3 Sonnet
      provider: Anthropic
      description: 平衡性能与成本
      enabled: false
      api-key: YOUR_API_KEY
      base-url: https://api.anthropic.com/v1
      model: claude-3-sonnet
      temperature: 0.7

    # 文心一言 4.5
    - id: ERNIE-4.5
      name: 文心一言 4.5
      provider: 百度
      description: 百度最强中文大模型
      enabled: false
      api-key: YOUR_API_KEY
      base-url: https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat
      model: ernie-4.5-8k-preview
      temperature: 0.7

    # GLM-4
    - id: GLM-4
      name: GLM-4
      provider: 智谱AI
      description: 中英双语优化模型
      enabled: false
      api-key: YOUR_API_KEY
      base-url: https://open.bigmodel.cn/api/paas/v4
      model: glm-4
      temperature: 0.7

    # 讯飞星火 V3.5
    - id: Spark
      name: 讯飞星火 V3.5
      provider: 科大讯飞
      description: 多模态交互能力
      enabled: false
      api-key: YOUR_API_KEY
      base-url: https://spark-api.xfyun.net/v3.5/chat
      model: generalv3.5
      temperature: 0.7
